<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwillbs.clish.common.scheduler.SchedulerMapper">
	                                   
	<select id="SelectDelteReservationList">
		SELECT *
		FROM RESERVATION
		WHERE reservation_status = 1
		AND NOW() - INTERVAL 2 HOUR >= reservation_com;
	</select>
	
	<select id="selectEndClasses" resultType="map">
		SELECT
			c.user_idx
			, c.class_title
			, DATE_FORMAT(c.end_date, '%Y-%m-%d') AS end_date
		FROM
			CLASS c
		WHERE
			DATE(c.end_date) = CURDATE()
		AND
			NOT EXISTS(
				SELECT 1
				FROM
					NOTIFICATION n
				WHERE
					n.user_idx = c.user_idx
				AND
					n.user_notice_message LIKE CONCAT('%', c.class_title, '%마감%')
			)
	</select>
	
</mapper>
